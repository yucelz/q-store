name: Test Build Wheels (No Publish)

# This workflow builds wheels for testing but does NOT publish to PyPI
# Use this for pull requests, development branches, or manual testing

on:
  pull_request:
    branches: [main, master, dev]
  workflow_dispatch:  # Allow manual triggering
    inputs:
      platforms:
        description: 'Platforms to build (comma-separated: linux,macos-arm,windows)'
        required: false
        default: 'linux'
        type: string

permissions:
  contents: read

jobs:
  test_pre_checks:
    name: Test Pre-flight Validation
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install build dependencies
        run: |
          python -m pip install --upgrade pip
          pip install build twine setuptools wheel

      - name: Validate package structure
        run: |
          if [[ ! -f "setup.py" ]] && [[ ! -f "pyproject.toml" ]]; then
            echo "::error::Neither setup.py nor pyproject.toml found!"
            exit 1
          fi
          echo "✓ Build configuration found"

      - name: Validate package metadata
        run: |
          python -m build --sdist --outdir /tmp/sdist-check
          python -m twine check /tmp/sdist-check/*
          echo "✓ Package metadata is valid"

      - name: Check Python syntax
        run: |
          python -m py_compile $(find . -name "*.py" ! -path "./build/*" ! -path "./dist/*" ! -path "./.venv/*")
          echo "✓ Python syntax is valid"
